# from: https://github.com/strasdat/vviz/blob/main/.github/workflows/ci.yml
name: Continuous integration

on:
  workflow_dispatch:
  push:
  pull_request:

jobs:
  build_and_test:
    name: Rust project
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Git Sumbodule Update
        run: |
          git submodule update --init --recursive
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - run: cargo build --release --all-features
      - name: "Cargo test"
        run: cargo test
      - name: "Cargo package"
        run: cargo package
      - if: github.event.review.state == 'approved'
        name: "Cargo publish"
        run: cargo login --token ${{ secrets.CRATES_TOKEN }} && cargo publish --no-verify
